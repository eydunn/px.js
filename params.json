{"note":"Don't delete this file! It's used internally to help with page regeneration.","body":"Px.js \r\n===\r\n## PC-Axis file parsing in JavaScript\r\n\r\nPx.js is a JavaScript library for extracting and manipulating data stored in PC-Axis files. It is intended as a generic solution which can handle any well-formed PC-Axis file.\r\n\r\nPx.js is primarily intended for use in a web browser but it can also be used as a Node.js module.\r\n\r\n### What is PC-Axis?\r\n\r\nPC-Axis is a file format used for dissemination of statistical information. The format is used by a large number of national\r\nstatistical organisations to disseminate official statistics. For general information on PC-Axis refer to the\r\n[PC-Axis web site](http://www.scb.se/Pages/StandardNoLeftMeny____314045.aspx) and for information on the file format specifically, see the\r\n[PC-Axis file format specification](http://www.scb.se/Pages/List____314011.aspx).\r\n\r\n## Dependencies\r\n\r\nPx.js is dependent on the [Underscore](http://underscorejs.org) JavaScript utility library.\r\n\r\n## Getting Started\r\n\r\n### In the browser\r\n\r\nDownload the minified [production version][min] or the [development version][max].\r\n\r\n[min]: https://raw.github.com/fod/px.js/master/dist/px.min.js\r\n[max]: https://raw.github.com/fod/px.js/master/dist/px.js\r\n\r\nInclude [Underscore](http://underscorejs.org) and Px.js in your HTML:\r\n\r\n```html\r\n<script type=\"text/javascript\" src=\"path/to/underscore.js\"></script>\r\n<script type=\"text/javascript\" src=\"path/to/px.js\"></script>\r\n```\r\n\r\nthen in your JavaScript:\r\n\r\n__For remote PC-Axis files:__\r\n\r\nPass the Px constructor the responseText from an XMLHttpRequest, for example: \r\n\r\n```javascript\r\nvar xhr = new XMLHttpRequest();\r\nxhr.onreadystatechange = function() {\r\n\tif (xhr.readyState === 4 && xhr.status === 200) {\r\n\t\tvar px = new Px(xhr.responseText);\r\n\t}\r\n};\r\n\r\nxhr.open('GET', 'path/to/remote/PC-Axis/file');\r\nxhr.send();\r\n```\r\n\r\n__For local PC-Axis files:__\r\n\r\nUse the FileReader API to pass the file to the Px constructor. For example, assuming a file input tag with the id 'pxfile' in your HTML...\r\n\r\n```html\r\n<input type=\"file\" id=\"pxfile\" />\r\n```\r\n\r\n...construct a new Px object in a callback triggered when a new file is selected:\r\n\r\n```javascript\r\ndocument.getElementById('pxfile').onchange = handlePxfile;\r\n\r\nvar px = {};\r\nfunction handlePxfile() {\r\n\tvar reader = new FileReader();\r\n\r\n    reader.onload = function() {\r\n\t\treturn px = new Px(reader.result);\r\n\t};\r\n\treader.readAsText(this.files[0]);\r\n}\r\n```\r\n\r\n### On the server\r\nInstall the module with npm: \r\n\r\n`npm install px`\r\n\r\nthen, in your code:\r\n\r\n```javascript\r\nvar Px = require('px'),\r\n    fs = require('fs');\r\n\t\r\nfs.readFile('path/to/PC-Axis/file', 'utf8', function(err, data) {\r\n\tpx = new Px(data);\r\n});\r\n```\r\n\r\n## Documentation\r\n\r\n### Synopsis\r\n\r\n```javascript\r\n// Constructor\r\nvar px = new Px(pxString);\r\n\r\n// return values for passed keyword\r\nvar keyword = px.keyword('KEYWORD');\r\n\r\n// return array containing all keywords\r\nvar keys = px.keywords();\r\n\r\n// return array containing all variables (STUBs & HEADINGs)\r\nvar vars = px.variables();\r\n\r\n// return variable at index 0 in variables array\r\nvar variable = px.variable(0);\r\n\r\n// return index of Region variable in variables array \r\nvar variable = px.variable('Region');\r\n\r\n// return array of values for passed variable\r\n// (can take array index or variable name)\r\nvar values = px.values(variable);\r\n\r\n// return array of value codes for passed variable\r\n// (can take array index or variable name)\r\nvar codes = px.codes(variable);\r\n    \r\n// return the data value for a passed array of variable values\r\nvar datapoint = px.datum([0,0,0,0]);\r\n\r\n// return a column of data\r\nvar column = px.dataCol(['*',0,0,0]);\r\n\r\n// return an associative array of data in the form: {valueName: data}\r\nvar column = px.dataDict(['*',0,0,0]);\r\n\r\n// Return an array of data objects, one for each datum\r\nvar entries = px.entries();\r\n\r\n// Remove values and associated data from Px object\r\npx.truncate([[2,3,4,5],['*'],['*'],['*']]);\r\n```\r\n\r\n### Construction\r\n\r\nA new PC-Axis object is constructed by passing a string containing a PC-Axis file's contents to the `Px` constructor. This will usually be done in the callback of a `FileReader.readAsText()` or an `XMLHttpRequest` (`resultText`) call, as both of these return a string containing the target file's contents.\r\n\r\n```javascript\r\nvar pxString; // String containing PC-Axis file's contents\r\nvar px = new Px(pxString);\r\n```\r\n\r\nThe Px constructor parses the PC-Axis file's data and metadata into two attributes, data and metadata, and returns an object equipped with a number of methods to access and manipulate its contents.\r\n\r\n### Attributes\r\n\r\nPx attributes are not intended to be accessed directly. Data and metadata are generally accessed more easily and more consistently via the object's methods.\r\n\r\n__metadata__\r\n\r\nThe `metadata` attribute is an object containing all of the PC-Axis file's metadata. Each of the metadata object's keys is a metadata keyword from the original PC-Axis file, each of its values is an object. Where a keyword in the original PC-Axis file has a single string value (meaning that the value applies to the entire dataset - e.g. the 'TITLE' keyword), then that keyword's value object contains a single key, 'TABLE', the value of which is the string to which that keyword pointed in the original PC-Axis file.\r\n\r\n```javascript\r\n// Return metadata object\r\nvar meta = px.metadata;\r\n\r\n// Return dataset's TITLE value as string\r\nvar title = px.metadata.TITLE.TABLE;\r\n\r\n// Return object with variables as keys and arrays of codes as values\r\nvar codes = px.metadata.CODES;\r\n\r\n// Return array of codes for Region variable\r\nvar regCodes = px.metadata.CODES.Region;\r\n```\r\n\r\n__data__\r\n\r\nThe `data` attribute is an array containing all of the values following the DATA keyword in the original PC-Axis file. The data are stored as strings. Missing or obfuscated data values (encoded usually as a series of dots (\"..\") or a dash (\"-\") in Pc-Axis files) are stored unchanged in the data object.\r\n\r\n```javascript\r\n// Return array of data\r\nvar data = px.data;\r\n```\r\n\r\n### Methods\r\n\r\n__keyword(String)__\r\n\r\nThe `keyword` method returns the _value_ of the passed _keyword_. If the _keyword_ holds a value which refers to the entire table (such as the 'TITLE' keyword), then that value is returned as a string. If the keyword passed to the method has different values for each variable (for example, the 'VALUES' and 'CODES' keywords will have a different list of values for each variable), then a reference to the object holding the entire set of values is returned by the method.\r\n\r\n```javascript\r\n// Return the value of the title keyword as a string\r\nvar title = px.keyword('TITLE');\r\n\r\n// Return object with variables as keys and arrays of codes as values\r\nvar codes = px.keyword('CODES');\r\n```\r\n\r\n__keywords()__\r\n\r\nThe `keywords` method returns an array containing all of the metadata _keywords_ associated with the PC-Axis dataset represented by the object.\r\n\r\n```javascript\r\n// Return an array of keywords\r\nvar metaKeys = px.keywords();\r\n```\r\n\r\n__title()__\r\n\r\nThe `title` method is a convenience method which returns the TITLE attribute of the dataset. It is equivalent to `metadata.TABLE.TITLE`.\r\n\r\n```javascript\r\n// Return TITLE of dataset\r\nvar title = px.title();\r\n```\r\n\r\n__variables()__\r\n\r\nThe `variables` method returns an array containing the names of all of the _variables_ present in the current PC-Axis file. The _variables_ in the returned array are ordered as they are in the PC-Axis file; first the STUB _variables_, followed by the HEADING _variables_.\r\n\r\n```javascript\r\n// Return an array of variable names\r\nvar variables = px.variables();\r\n```\r\n\r\n__variable(String or Array-Index)__\r\n\r\nWhen passed an array index the variable method returns the variable name at that index in an array composed of [STUB variables, HEADING variables] - i.e. the array returned by the variables method.\r\n\r\nWhen passed a string (containing a variable name) this method returns the index in the variables array at which the named variable occurs.\r\n\r\n```javascript\r\n// Return the name of the variable at position 0 in the variables array\r\nvar varName = px.variable(0);\r\n\r\n// Return the position (array index) of the 'Region' variable in the variables array\r\nvar idx = px.variable('Region');\r\n```\r\n\r\n__valCounts()__\r\n\r\nReturns an array of value counts. Each element in the array is the number of possible values in the current PC-Axis dataset for the variable with the same index (in the variables array) as the element.\r\n\r\n```javascript\r\n// Return array of value counts\r\nvar counts = px.valCounts();\r\n```\r\n\r\n__values(String or Array-Index)__\r\n\r\nWhen passed the name of a variable or the index of a variable in the variables array the values method returns an array containing the names of all possible values for that variable.\r\n\r\nThe order of the values in the array returned by this method matches the order in the original file.\r\n\r\n```javascript\r\n// Return an array of all possible values (by name) for the variable at position 0 in the variables array\r\nvar vals = px.values(0);\r\n\r\n// Return an array of possible values (by name) for the 'Region' variable\r\nvar vals = px.values('Region');\r\n```\r\n\r\n__codes(String or Array-Index)__\r\n\r\nWhen passed the name of a variable or the index of a variable in the variables array the codes method returns an array containing the codes for all possible values for that variable.\r\n\r\nThe order of the value codes in the array returned by this method matches the order in the original file.\r\n\r\n```javascript\r\n// Return an array of all possible values (by code) for the variable at position 0 in the variables array\r\nvar codes = px.codes(0);\r\n\r\n// Return an array of possible values (by code) for the 'Region' variable\r\nvar codess = px.codes('Region');\r\n```\r\n\r\n__value(String, String)__\r\n\r\nReturns the value name corresponding to the value code and variable name passed.\r\n\r\n```javascript\r\n// Return the value for the 'Region' variable, for which the code is '01'\r\nvar code = value('01', 'Region');\r\n```\r\n\r\n__code(String, String)__\r\n\r\nReturns the code corresponding to the value name and variable name passed.\r\n\r\n```javascript\r\n// Return the code for the 'Region' variable named 'State'\r\nvar code = value('State', 'Region');\r\n```\r\n\r\n__datum(Array-of-Array-Indices)__\r\n\r\nThe ```datum``` method takes an array of value indices and returns the data value corresponding to the particular combination of values represented by those indices. The number of elements in the passed array must be equal to the number of variables in the current PC-Axis dataset. Each element must be a positive integer no greater than the number of possible values for the variable it represents.  \r\n\r\nFor example, consider a dataset containing two variables, each of which has two possible values:\r\n\r\n```javascript\r\n// Two variables\r\npx.variables();    // ['Sex', 'Year']\r\n\r\n// Each variable has two possible values\r\npx.values('Sex');  // ['Male', 'Female']\r\npx.values('Year'); // ['2011', '2012']\r\n\r\npx.datum([0,0]);  // Data value for males in 2011\r\npx.datum([0,1]);  // Data value for males in 2012\r\npx.datum([1,0]);  // Data value for females in 2011\r\npx.datum([1,1]);  // Data value for females in 2012\r\n```\r\n\r\n__dataCol(Array-of-Array-Indices)__\r\n\r\nThe ```dataCol``` method is similar to the datum method except that one of the elements in the passed array is replaced with a ```'*'``` character and rather than returning a single datum it returns an array of data containing a datum for each possible value for the variable represented by the ```'*'```.\r\n\r\nFor example, consider a dataset containing two variables, each of which has two possible values:\r\n\r\n```javascript\r\n// Two variables \r\npx.variables();       // ['Sex', 'Year'] \r\n\r\n// Each variable has two possible values \r\npx.values('Sex');     // ['Male', 'Female'] \r\npx.values('Year');    // ['2011', '2012'] \r\n\r\npx.dataCol(['*',0]);  // [Data value for males in 2011, Data value for females in 2011] \r\npx.dataCol(['*',1]);  // [Data value for males in 2012, Data value for females in 2012]\r\npx.dataCol([0,'*']);  // [Data value for males in 2011, Data value for males in 2012]\r\npx.dataCol([1,'*']);  // [Data value for females in 2011, Data value for females in 2012]\r\n```\r\n\r\n__dataDict(Array-of-Array-Indices)__\r\n\r\nThe ```dataDict``` method takes and array of _value_ indices, one of which is replaced with a ```'*'``` and returns an object, the keys of which are all of the possible _values_ for the variable represented by the ```'*'```, and the values are the data values associated with the key _value_ and the particular combination of other _value_ indices in the passed array.\r\n\r\nFor example, consider a dataset containing two variables, each of which has two possible values:\r\n\r\n```javascript\r\n// Two variables \r\npx.variables();       // ['Sex', 'Year'] \r\n\r\n// Each variable has two possible values \r\npx.values('Sex');     // ['Male', 'Female'] \r\npx.values('Year');    // ['2011', '2012'] \r\n\r\npx.dataDict(['*',0]); // { 'Male': Data value for males in 2011, \r\n                      //   'Female': Data value for females in 2011 }\r\n\t\t\t\t\t   \r\npx.dataDict(['*',1]); // { 'Male': Data value for males in 2012, \r\n                      //   'Female': Data value for females in 2012 }\r\n\r\npx.dataDict([0,'*']); // { '2011': Data value for males in 2011, \r\n                      //   '2012': Data value for males in 2012 }\r\n\r\npx.dataDict([1,'*']); // { '2011': Data value for females in 2011, \r\n                      //   '2012': Data value for females in 2012 }\r\n```\r\n\r\n__entries()__\r\n\r\nThe ```entries``` method takes no arguments and returns an array of objects containing one object for each datum in the dataset. Each object contains a key for each variable in the dataset, as well as a value for that key, and an additional key, \"num\", the value of which is the data value associated with that particular combination of variable values.\r\n\r\nFor example, consider a dataset containing two variables, each of which has two possible values:\r\n\r\n```javascript\r\n// Two variables \r\npx.variables();       // ['Sex', 'Year'] \r\n\r\n// Each variable has two possible values \r\npx.values('Sex');     // ['Male', 'Female'] \r\npx.values('Year');    // ['2011', '2012'] \r\n\r\npx.entries(); // [ \r\n              //   { 'Sex': 'Male', 'Year': '2011', 'num': Data value for males in 2011 },\r\n              //   { 'Sex': 'Male', 'Year': '2012', 'num': Data value for males in 2012 },\r\n\t\t\t  //   { 'Sex': 'Female', 'Year': '2011', 'num': Data value for females in 2011 },\r\n\t\t\t  //   { 'Sex': 'Female', 'Year': '2012', 'num': Data value for females in 2012 }\r\n\t\t\t  // ]\r\n```\r\n\r\n__truncate(Array-of-Arrays-of-Array-Indices)__\r\n\r\nThe `truncate` method removes values and associated data from the Px object. The method takes an array of arrays. Each nested array consists of a list of indices of the values to be kept for the variable represented by that array. A `'*'` in any variable's array indicates that all of that variable's values should be retained. This method alters the current Px object and returns nothing. Its intended use is to allow a very large dataset, only some of which is required, to be reduced to a more manageable size.\r\n\r\nFor example, consider a dataset containing three variables, each of which has three possible values:\r\n\r\n```javascript\r\n// Two variables \r\npx.variables();         // ['Sex', 'Year', 'Age Group'] \r\n\r\n// Each variable has two possible values \r\npx.values('Sex');       // ['Male', 'Female', 'Both Sexes'] \r\npx.values('Year');      // ['2010', '2011', '2012']\r\npx.values('Age Group'); // ['<16', '17-64', '65+']\r\n\r\n// Retain 'Sex': 'Male', 'Female'; 'Year': '2012'; All Age Groups\r\npx.truncate([[0,1],[2],['*']]);\r\n\r\n// OR\r\n\r\n// Retain 'Sex': 'Both Sexes'; All Years; 'Age Group': '<16', '65+'\r\npx.truncate([[2],['*'],[0,2]]);\r\n\r\n```\r\n\r\n## Extending Px.js\r\n\r\nPx.js can be easily extended to include methods and attributes for handling special tasks or for dealing with the peculiarities of PC-Axis files from some specific source. For an example of a Px.js extension designed to detect, identify and decode Irish ([CSO](http://www.cso.ie/)) PC-Axis datasets which have a geographical dimension see [px-geog-ie.js](https://github.com/fod/px-geog-ie.js/blob/master/px-geog-ie.js).\r\n\r\nTo extend Px.js, simply add methods or attributes to `Px.prototype`. The best way to do this is probably to define an immediately invoked function expression (IIFE) in your extension's JS file and to have that function add your new methods and attributes to the Px prototype within that IIFE. The extension JS file can then be included in your html _after_ Px.js has been included:\r\n\r\n```html\r\n<script type=\"text/javascript\" src=\"path/to/underscore.js\"></script>\r\n<script type=\"text/javascript\" src=\"path/to/px.js\"></script>\r\n<script type=\"text/javascript\" src=\"path/to/px-extension.js\"></script>\r\n```\r\n\r\nThe `px-extension.js` file might look like this:\r\n\r\n```javascript\r\n(function() {\r\n    var px = Px.prototype;\r\n\t\r\n\tpx.someMethod = function() {\r\n\t\t...\r\n\t};\r\n\t\r\n\tpx.someAttribute = {...};\r\n\t\r\n}());\r\n\r\n```\r\n\r\nIn Node simply `require()` your extension after the `px` library.\r\n\r\n## Contributing\r\n\r\nBug fixes and enhancements are welcome. You'll need [grunt](https://github.com/cowboy/grunt) to build the project, and [nodeunit](https://github.com/caolan/nodeunit) to run the test suite. The built files in the `/dist` directory are generated by grunt on build and shouldn't be edited - the development file is `/lib/px.js`. In addition to the nodeunit test suite the `use-test` directory contains `use-test.html` which allows you to browse to a PC-Axis file and parse it so that you can play about (or manually test) the library in your browser's development console. A similar use-test file, but for Node, `node-use-test.js`, can also be found in the `/test/use-test/` directory. \r\n\r\n## Bugs & Feature Requests\r\n\r\nBugs and feature requests can be submitted to the project [issue tracker](https://github.com/fod/px.js/issues). Please link to the PC-Axis file which caused the problem if applicable, including its provenance as it is likely to be included in the test suite. A failing test would be nice too.\r\n\r\n## License\r\n\r\nCopyright (c) 2012 Fiachra O'Donoghue  \r\nLicensed under the MIT license.\r\n\r\n","name":"Px.js","google":"UA-16322261-3","tagline":"PC-Axis file parsing in JavaScript"}